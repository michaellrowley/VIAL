function severityString(e){switch(e.type.toUpperCase()){case"CVSS3":const t=[{below:.1,level:"None"},{below:4,level:"Low"},{below:7,level:"Medium"},{below:9,level:"High"},{below:10.1,level:"Critical"}],n=CVSS31.calculateCVSSFromVector("CVSS:3.1/"+e.value).baseMetricScore;for(index in t)if(n<t[index].below)return t[index].level;case"SSVC":case"CUSTOM":return e.value}}function hexDecode(e){for(var t="",n=0;n<e.length;n+=2)t+=String.fromCharCode(parseInt(e.substr(n,2),16));return t}IPFS_GATEWAY="gateway.ipfs.io";let ipfsRequest=new XMLHttpRequest;ipfsRequest.open("GET","https://ipfs.io/ipns/entries.vial.michaelrowley.dev/"),ipfsRequest.onreadystatechange=async function(e){if(4===ipfsRequest.readyState){if(200!==ipfsRequest.status)return void showFail("Unable to query IPFS gateway for critical entry list.");data=JSON.parse(ipfsRequest.responseText);const e=document.getElementById("browse-table");let t=null;for(const n of Object.keys(data).reverse()){const s=data[n],i=document.createElement("tr"),r=document.createElement("td");r.innerText=n;const o=document.createElement("td"),a=document.createElement("td"),l=document.createElement("td");for(ipfsRequest=new XMLHttpRequest,ipfsRequest.open("GET","https://"+IPFS_GATEWAY+"/ipfs/"+s.cid),ipfsRequest.onreadystatechange=function(e){if(4===ipfsRequest.readyState){if(200!==ipfsRequest.status)return void(t="FAILED");let n={};try{const e=s.key,t=new fernet.Secret(hexDecode(e));let i=new fernet.Token({secret:t,token:ipfsRequest.responseText,ttl:0}).decode();n=JSON.parse(i)}catch(e){return void(t="FAILED")}o.innerText=n.product,a.innerText=n.owner,l.innerText=severityString(n.severity),t="COMPLETED"}},t=null,ipfsRequest.send();null===t;)await new Promise((e=>setTimeout(e,5)));"COMPLETED"!==t&&(o.innerText="~~~",a.innerText="~~~",l.innerText="~~~"),i.append(r),i.append(o),i.append(a),i.append(l),i.onclick=function(){window.open("../view/view.html?id="+n,"_blank")},e.appendChild(i)}}},ipfsRequest.send();
